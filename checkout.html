<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<title>Checkout | Titan Mart BD</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{margin:0;font-family:Arial,sans-serif;background:#f4f6f8;}
.header{
  background:#ff4c00;
  color:#fff;
  padding:18px;
  text-align:center;
  font-size:22px;
  font-weight:bold;
}
.container{max-width:720px;margin:20px auto;}
.card{
  background:#fff;
  padding:22px;
  border-radius:12px;
  box-shadow:0 8px 25px rgba(0,0,0,0.15);
}
input,select{
  width:100%;
  padding:12px;
  margin-top:10px;
  border-radius:8px;
  border:1px solid #ccc;
}
input:focus,select:focus{
  outline:none;
  border-color:#ff4c00;
}
.product-img{
  width:100%;
  max-height:260px;
  object-fit:contain;
  margin-top:15px;
}
.info{margin-top:10px;}
.total{
  font-size:18px;
  font-weight:bold;
  margin-top:12px;
}
.delivery-note{
  color:#ff4c00;
  font-weight:bold;
  margin-top:6px;
}
button{
  width:100%;
  padding:15px;
  margin-top:18px;
  background:#ff4c00;
  color:#fff;
  border:none;
  border-radius:8px;
  font-size:16px;
  cursor:pointer;
}
button:hover{background:#e04300;}
.lang{
  text-align:right;
  font-weight:bold;
  cursor:pointer;
  color:#ff4c00;
  margin-bottom:10px;
}
</style>
</head>

<body>

<div class="header">Titan Mart BD</div>

<div class="container">
<div class="card">

<div class="lang" onclick="toggleLang()">EN</div>

<h2 id="title">চেকআউট</h2>

<input id="name" placeholder="আপনার নাম">
<input id="phone" placeholder="মোবাইল নাম্বার">
<input id="address" placeholder="সম্পূর্ণ ঠিকানা">

<div class="info">
<b>জেলা</b>
<input id="districtSearch" placeholder="জেলা খুঁজুন">
<select id="district"></select>
</div>

<div class="info">
<b>থানা / উপজেলা</b>
<input id="thanaSearch" placeholder="থানা খুঁজুন">
<select id="thana"></select>
</div>

<img id="productImg" class="product-img">

<div class="info"><b>পণ্য:</b> <span id="product"></span></div>
<div class="info"><b>মূল্য:</b> ৳ <span id="price"></span></div>

<select id="qty">
  <option value="1">1</option>
  <option value="2">2</option>
  <option value="3">3</option>
  <option value="4">4</option>
</select>

<div class="total">মোট: ৳ <span id="total"></span></div>
<div class="delivery-note">
Inside Dhaka: 60৳ | Outside Dhaka: 120৳
</div>

<button onclick="placeOrder()">অর্ডার কনফার্ম করুন</button>

</div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function(){

/* ---------- PRODUCT SET ---------- */
const params = new URLSearchParams(window.location.search);
let product = params.get("product") || "Arc Lighter";
let price = 0;
let img = "";

if(product==="Arc Lighter"){
  price = 850;
  img = "arc-lighter.jpg";
}else if(product==="Nose Hair Trimmer"){
  price = 840;
  img = "nose-hair-trimmer.jpg";
}

document.getElementById("product").innerText = product;
document.getElementById("price").innerText = price;
document.getElementById("productImg").src = img;

/* ---------- ORDER ID ---------- */
function orderID(){
  return "TM"+Math.floor(100000+Math.random()*900000);
}

/* ---------- LOAD DISTRICT JSON ---------- */
let data = {};
fetch("bangladesh_upazilas.json")
.then(r=>r.json())
.then(d=>{
  data=d;
  loadDistrict();
});

function loadDistrict(){
  let d=document.getElementById("district");
  Object.keys(data).forEach(x=>{
    let o=document.createElement("option");
    o.text=o.value=x;
    d.add(o);
  });
  loadThana();
  calc();
}

function loadThana(){
  let t=document.getElementById("thana");
  t.innerHTML="";
  let d=document.getElementById("district").value;
  (data[d]||[]).forEach(x=>{
    let o=document.createElement("option");
    o.text=o.value=x;
    t.add(o);
  });
}

/* ---------- CALCULATION ---------- */
function calc(){
  let q=+document.getElementById("qty").value;
  let d=document.getElementById("district").value;
  let delivery = (d==="ঢাকা")?60:120;
  document.getElementById("total").innerText = price*q + delivery;
}

document.getElementById("qty").onchange=calc;
document.getElementById("district").onchange=()=>{loadThana();calc();};

/* ---------- SEARCH ---------- */
districtSearch.oninput=function(){
  let f=this.value.toLowerCase();
  district.innerHTML="";
  Object.keys(data).filter(x=>x.toLowerCase().includes(f)).forEach(x=>{
    let o=document.createElement("option");
    o.text=o.value=x;
    district.add(o);
  });
  loadThana();
};

thanaSearch.oninput=function(){
  let f=this.value.toLowerCase();
  let d=district.value;
  thana.innerHTML="";
  (data[d]||[]).filter(x=>x.toLowerCase().includes(f)).forEach(x=>{
    let o=document.createElement("option");
    o.text=o.value=x;
    thana.add(o);
  });
};

/* ---------- PLACE ORDER ---------- */
window.placeOrder=function(){
  let n=name.value.trim();
  let p=phone.value.trim();
  let a=address.value.trim();
  if(!n||!p||!a){
    alert("নাম, মোবাইল ও ঠিকানা আবশ্যক");
    return;
  }

  let d=district.value;
  let t=thana.value;
  let q=qty.value;
  let delivery=(d==="ঢাকা")?60:120;
  let total=price*q+delivery;
  let id=orderID();

  let now=new Date();
  let date=now.toLocaleDateString("bn-BD");
  let time=now.toLocaleTimeString("en-US",{hour12:false});

  let msg=`Order ID: ${id}
Date: ${date}
Time: ${time}
Name: ${n}
Phone: ${p}
Address: ${a}
District: ${d}
Thana: ${t}
Product: ${product}
Qty: ${q}
Delivery: ${delivery}৳
Total: ${total}৳`;

  window.open("https://wa.me/8801980236917?text="+encodeURIComponent(msg),"_blank");
};

/* ---------- LANGUAGE ---------- */
let bn=true;
window.toggleLang=function(){
  bn=!bn;
  title.innerText=bn?"চেকআউট":"Checkout";
  name.placeholder=bn?"আপনার নাম":"Your Name";
  phone.placeholder=bn?"মোবাইল নাম্বার":"Phone Number";
  address.placeholder=bn?"সম্পূর্ণ ঠিকানা":"Full Address";
  document.querySelector(".lang").innerText=bn?"EN":"BN";
};

});
</script>

</body>
</html>
