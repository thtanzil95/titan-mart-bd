<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Titan Mart BD Checkout</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{margin:0;font-family:Arial,sans-serif;background:#f5f5f5;}
.container{max-width:720px;margin:40px auto;padding:20px;background:#fff;border-radius:10px;box-shadow:0 10px 30px rgba(0,0,0,0.15);}
h2{text-align:center;color:#ff4c00;margin-bottom:20px;}
input,select{width:100%;padding:12px;margin:8px 0;border:1px solid #ccc;border-radius:8px;}
button{width:100%;padding:15px;margin-top:15px;background:#ff4c00;color:#fff;border:none;font-size:16px;border-radius:8px;cursor:pointer;}
button:hover{background:#e04300;}
.product-img{width:100%;max-height:220px;object-fit:contain;margin:10px 0;}
.info{margin:5px 0;font-weight:bold;}
</style>
</head>
<body>

<div class="container">
<h2>Checkout</h2>

<!-- Customer Info -->
<input id="name" placeholder="Your Name">
<input id="phone" placeholder="Phone Number">
<input id="address" placeholder="Full Address">

<!-- District & Thana -->
<div class="info">District:</div>
<select id="district"></select>
<div class="info">Thana/Upazila:</div>
<select id="thana"></select>

<!-- Product Info -->
<img id="productImg" class="product-img" src="" alt="Product">
<div class="info">Product: <span id="productName"></span></div>
<div class="info">Price: ৳<span id="productPrice"></span></div>

<select id="qty">
  <option value="1">1</option>
  <option value="2">2</option>
  <option value="3">3</option>
  <option value="4">4</option>
</select>

<div class="info">Delivery Charge: ৳<span id="delivery"></span></div>
<div class="info">Total: ৳<span id="total"></span></div>

<button onclick="placeOrder()">Buy Now</button>
</div>

<script>
// Product from URL
const params = new URLSearchParams(window.location.search);
const product = params.get("product");
const price = parseInt(params.get("price"));
document.getElementById("productName").innerText = product;
document.getElementById("productPrice").innerText = price;
document.getElementById("productImg").src = product==="Arc Lighter"?"arc-lighter.jpg":"nose-hair-trimmer.jpg";

// 64 District + Upazila example (replace with full JSON)
let upazilaData = {
  "Dhaka":["Dhanmondi","Kafrul","Gulshan"],
  "Chattogram":["Pahartali","Halishahar"],
  "Khulna":["Sonadanga","Khalishpur"]
  // add all districts + thana JSON here
};

// Populate district & thana
const districtSel = document.getElementById("district");
const thanaSel = document.getElementById("thana");

function populateDistricts(){
  districtSel.innerHTML="";
  Object.keys(upazilaData).forEach(d=>{
    const opt = document.createElement("option"); opt.value=d; opt.text=d; districtSel.add(opt);
  });
  populateThana();
}
function populateThana(){
  thanaSel.innerHTML="";
  const dist = districtSel.value;
  (upazilaData[dist]||[]).forEach(t=>{
    const opt = document.createElement("option"); opt.value=t; opt.text=t; thanaSel.add(opt);
  });
  calcTotal();
}

// Calculate delivery & total
function calcTotal(){
  const qty = parseInt(document.getElementById("qty").value);
  const dist = districtSel.value;
  let delivery = (dist==="Dhaka")?60:120;
  document.getElementById("delivery").innerText = delivery;
  document.getElementById("total").innerText = price*qty + delivery;
}

// Event listeners
districtSel.onchange = populateThana;
document.getElementById("qty").onchange = calcTotal;

// Unique Order ID
function orderID(){ return "TM"+Math.floor(100000+Math.random()*900000); }

// Place Order
function placeOrder(){
  const name=document.getElementById("name").value.trim();
  const phone=document.getElementById("phone").value.trim();
  const address=document.getElementById("address").value.trim();
  const district = districtSel.value;
  const thana = thanaSel.value;
  const qty = parseInt(document.getElementById("qty").value);
  const delivery = parseInt(document.getElementById("delivery").innerText);
  const total = parseInt(document.getElementById("total").innerText);

  if(!name || !phone || !address){
    alert("Please fill Name, Phone & Address!");
    return;
  }

  const id = orderID();
  const now = new Date();
  const date = now.toLocaleDateString();
  const time = now.toLocaleTimeString();

  const orderData = {
    orderId:id,
    date:date,
    time:time,
    name:name,
    phone:phone,
    address:address,
    district:district,
    thana:thana,
    product:product,
    qty:qty,
    delivery:delivery,
    total:total
  };

  // Send to Google Sheet
  fetch("https://script.google.com/macros/s/AKfycbyRGsQ8Alu7YlcaENawN28-aWJT2ER-OGDmVvIpuUbcne3Tj20ZyZRnwPsCO8VF0mXyRQ/exec",{
    method:"POST",
    body:JSON.stringify(orderData)
  }).then(res=>res.text()).then(txt=>console.log(txt));

  // WhatsApp Auto
  const msg = `Order ID: ${id}\nDate: ${date}\nTime: ${time}\nName: ${name}\nPhone: ${phone}\nAddress: ${address}\nDistrict: ${district}\nThana: ${thana}\nProduct: ${product}\nQuantity: ${qty}\nDelivery Charge: ৳${delivery}\nTotal: ৳${total}`;
  window.open("https://wa.me/8801980236917?text="+encodeURIComponent(msg),"_blank");
}

populateDistricts();
</script>
</body>
</html>
