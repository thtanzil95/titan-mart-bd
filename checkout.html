<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<title>Checkout | Titan Mart BD</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{margin:0;font-family:Arial;background:#f5f5f6}
.container{max-width:650px;margin:30px auto;background:#fff;padding:20px;border-radius:8px}
h2{text-align:center}
input,select{width:100%;padding:10px;margin-top:10px;border:1px solid #ccc;border-radius:5px}
button{width:100%;padding:12px;margin-top:15px;background:#ff4c00;color:#fff;border:none;font-size:16px;border-radius:5px;cursor:pointer}
.lang-btn{text-align:right;cursor:pointer;color:#ff4c00;font-weight:bold}
.info{margin-top:10px}
img.product-img{width:100%;max-height:250px;object-fit:contain;margin-top:10px;border-radius:5px}
</style>
</head>
<body>

<div class="container">
  <div class="lang-btn" onclick="toggleLang()">EN</div>
  <h2 id="title">চেকআউট</h2>

  <!-- Customer Information -->
  <input id="name" placeholder="আপনার নাম" required>
  <input id="phone" placeholder="মোবাইল নাম্বার" required>

  <!-- District + Thana -->
  <div class="info">
    <b id="dLabel">জেলা:</b>
    <input type="text" id="districtSearch" placeholder="জেলা খুঁজুন...">
    <select id="district" required></select>
  </div>

  <div class="info">
    <b id="thLabel">থানা/উপজেলা:</b>
    <input type="text" id="thanaSearch" placeholder="থানা/উপজেলা খুঁজুন...">
    <select id="thana" required></select>
  </div>

  <!-- Product Info -->
  <img id="productImg" class="product-img" src="" alt="Product Image">

  <div class="info"><b id="pLabel">পণ্য:</b> <span id="product"></span></div>
  <div class="info"><b id="prLabel">মূল্য:</b> ৳ <span id="price"></span></div>

  <!-- Quantity + Total -->
  <select id="qty">
    <option value="1">পরিমাণ 1</option>
    <option value="2">পরিমাণ 2</option>
    <option value="3">পরিমাণ 3</option>
    <option value="4">পরিমাণ 4</option>
  </select>

  <div class="info"><b id="tLabel">মোট:</b> ৳ <span id="total"></span></div>

  <button onclick="placeOrder()" id="btn">অর্ডার কনফার্ম করুন</button>
</div>

<script>
// Product details from URL
const params = new URLSearchParams(window.location.search);
const product = params.get("product");
const price = parseInt(params.get("price"));
document.getElementById("product").innerText = product;
document.getElementById("price").innerText = price;
document.getElementById("productImg").src = product==="Arc Lighter"?"images/arc-lighter.jpg":"images/nose-hair-trimmer.jpg";

// Total calculation
function calc(){ document.getElementById("total").innerText = price * document.getElementById("qty").value; }
calc(); document.getElementById("qty").onchange = calc;

// Unique order ID
function orderID(){ return "TM" + Math.floor(100000 + Math.random()*900000); }

// Place order via WhatsApp
function placeOrder(){
  const id = orderID();
  const name = document.getElementById("name").value;
  const phone = document.getElementById("phone").value;
  const district = document.getElementById("district").value;
  const thana = document.getElementById("thana").value;
  const total = document.getElementById("total").innerText;

  const msg = 
`Order ID: ${id}
Name: ${name}
Phone: ${phone}
District: ${district}
Thana/Upazila: ${thana}
Product: ${product}
Quantity: ${document.getElementById("qty").value}
Total: ৳${total}`;

  window.open("https://wa.me/8801980236917?text="+encodeURIComponent(msg), "_blank");
}

// Bangla / English toggle
let bn=true;
function toggleLang(){
  bn = !bn;
  document.getElementById("title").innerText = bn?"চেকআউট":"Checkout";
  document.getElementById("name").placeholder = bn?"আপনার নাম":"Your Name";
  document.getElementById("phone").placeholder = bn?"মোবাইল নাম্বার":"Phone Number";
  document.getElementById("pLabel").innerText = bn?"পণ্য:":"Product:";
  document.getElementById("prLabel").innerText = bn?"মূল্য:":"Price:";
  document.getElementById("tLabel").innerText = bn?"মোট:":"Total:";
  document.getElementById("dLabel").innerText = bn?"জেলা:":"District:";
  document.getElementById("thLabel").innerText = bn?"থানা/উপজেলা:":"Thana/Upazila:";
  document.getElementById("btn").innerText = bn?"অর্ডার কনফার্ম করুন":"Confirm Order";
  document.querySelector(".lang-btn").innerText = bn?"EN":"BN";
}

// Load upazila JSON file you uploaded
let upazilaData = {};
fetch("bangladesh_upazilas.json")
  .then(resp => resp.json())
  .then(data => {
    upazilaData = data;
    populateDistricts();
  });

// Populate district list
function populateDistricts(){
  const districtSel = document.getElementById("district");
  Object.keys(upazilaData).forEach(d => {
    let o = document.createElement("option");
    o.value = d; o.text = d;
    districtSel.add(o);
  });
  populateThana();
}

// Populate thana dropdown
function populateThana(){
  const thanaSel = document.getElementById("thana");
  thanaSel.innerHTML = "";
  const dist = document.getElementById("district").value;
  (upazilaData[dist] || []).forEach(t => {
    let o = document.createElement("option");
    o.value = t; o.text = t;
    thanaSel.add(o);
  });
}
document.getElementById("district").onchange = function(){
  populateThana();
};

// Search filters
document.getElementById("districtSearch").oninput = function(){
  const f = this.value.toLowerCase();
  const sel = document.getElementById("district");
  sel.innerHTML = "";
  Object.keys(upazilaData).filter(d=>d.toLowerCase().includes(f))
    .forEach(d => {
      let o = document.createElement("option");
      o.value = d; o.text = d;
      sel.add(o);
    });
  populateThana();
};

document.getElementById("thanaSearch").oninput = function(){
  const f = this.value.toLowerCase();
  const thSel = document.getElementById("thana");
  thSel.innerHTML = "";
  const dist = document.getElementById("district").value;
  (upazilaData[dist] || []).filter(t=>t.toLowerCase().includes(f))
    .forEach(t => {
      let o = document.createElement("option");
      o.value = t; o.text = t;
      thSel.add(o);
    });
};
</script>

</body>
</html>
