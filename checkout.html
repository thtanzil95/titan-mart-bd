<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Checkout | Titan Mart</title>
<style>
body{font-family:Arial, sans-serif; padding:20px; background:#f7f7f7;}
h2{text-align:center; color:#ff4c00;}
form{max-width:450px;margin:auto;background:white;padding:20px;border-radius:10px;box-shadow:0 2px 10px rgba(0,0,0,0.1);}
input, select{padding:10px; margin:10px 0; width:100%; border-radius:5px; border:1px solid #ccc;}
button{background:#ff4c00;color:white;padding:12px; width:100%; border:none; border-radius:5px; cursor:pointer; font-size:16px;}
button:hover{background:#e24300;}
.total{font-weight:bold; font-size:18px; margin:10px 0;}
</style>
</head>
<body>

<h2>Checkout Page</h2>

<form id="checkoutForm">
  Name: <input id="name" type="text" required><br>
  Phone: <input id="phone" type="text" required><br>
  Alt Phone: <input id="altphone" type="text"><br>
  District: <input id="district" type="text" required><br>
  Address: <input id="address" type="text" required><br>

  Product:
  <select id="product" onchange="updateTotal()">
    <option value="850">Arc Lighter</option>
    <option value="840">Nose Hair Trimmer</option>
  </select><br>

  Quantity: <input id="qty" type="number" value="1" min="1" onchange="updateTotal()"><br>

  Delivery:
  <select id="delivery" onchange="updateTotal()">
    <option value="0">Standard</option>
    <option value="50">Express (+50)</option>
  </select><br>

  <div class="total">Total: <span id="total">850</span> Taka</div>

  <button type="button" onclick="sendOrder()">Place Order</button>
</form>

<script>
// Update total price
function updateTotal(){
  let productPrice = parseInt(document.getElementById("product").value);
  let qty = parseInt(document.getElementById("qty").value);
  let delivery = parseInt(document.getElementById("delivery").value);
  let total = (productPrice * qty) + delivery;
  document.getElementById("total").innerText = total;
}

// Send order
function sendOrder(){
  let name = document.getElementById("name").value;
  let phone = document.getElementById("phone").value;
  let altphone = document.getElementById("altphone").value;
  let district = document.getElementById("district").value;
  let address = document.getElementById("address").value;
  let productText = document.getElementById("product").options[document.getElementById("product").selectedIndex].text;
  let qty = document.getElementById("qty").value;
  let deliveryText = document.getElementById("delivery").options[document.getElementById("delivery").selectedIndex].text;
  let total = document.getElementById("total").innerText;

  if(!name || !phone || !district || !address){
    alert("Please fill all required fields!");
    return;
  }

  // WhatsApp message
  let msg = encodeURIComponent(
    `üõí New Order\n\nüë§ Name: ${name}\nüìû Phone: ${phone}\nüìû Alt: ${altphone}\nüìç District: ${district}\nüè† Address: ${address}\nüì¶ Product: ${productText}\nüî¢ Qty: ${qty}\nüöö Delivery: ${deliveryText}\nüí∞ Total: ${total}`
  );

  // Open WhatsApp in new tab
  let win = window.open("https://wa.me/8801980236917?text="+msg, "_blank");
  if(win) win.focus();

  // Send order to Google Sheet (background)
  fetch("WEB_APP_URL_HERE", {  // <-- Replace with your Apps Script Web App URL
    method:"POST",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify({
      name, phone, altphone, district, address,
      product: productText, qty, delivery: deliveryText, total
    })
  })
  .then(res=>res.json())
  .then(data=>console.log("Sheet Response:", data))
  .catch(err=>console.error("Sheet Error:", err));

  // Redirect only after user confirms
  let proceed = confirm("WhatsApp ‡¶ñ‡ßÅ‡¶≤‡ßá‡¶õ‡ßá‡•§ Message ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã‡¶∞ ‡¶™‡¶∞ OK ‡¶ö‡¶æ‡¶™‡ßÅ‡¶® Success page ‡¶è ‡¶Ø‡ßá‡¶§‡ßá‡•§");
  if(proceed){
    window.location.href="success.html";
  }
}

// Initialize total on load
updateTotal();
</script>

</body>
</html>
