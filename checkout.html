<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Checkout | Titan Mart BD</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{margin:0;font-family:Arial;background:#f2f4f8;}
.container{max-width:720px;margin:30px auto;padding:15px;}
.card{background:#fff;border-radius:14px;padding:25px;box-shadow:0 10px 30px rgba(0,0,0,.15);}
h2{text-align:center;color:#ff4c00;}
label{font-weight:600;margin-top:14px;display:block;}
input,select{width:100%;padding:12px;margin-top:8px;border:1px solid #ccc;border-radius:8px;}
.product-img{width:100%;max-height:260px;object-fit:contain;margin-top:15px;border-radius:10px;}
.info{margin-top:10px;}
.total{font-size:18px;font-weight:bold;margin-top:12px;}
.note{font-size:13px;color:#555;margin-top:8px;}
button{width:100%;margin-top:20px;padding:15px;background:#ff4c00;color:#fff;border:none;font-size:16px;border-radius:8px;cursor:pointer;}
.brand{text-align:center;font-weight:bold;margin-bottom:10px;}
.search{margin-top:6px;}
</style>
</head>

<body>

<div class="container">
<div class="card">

<div class="brand">Titan Mart BD</div>
<h2>Checkout</h2>

<label>Full Name *</label>
<input id="name">

<label>Mobile Number *</label>
<input id="phone">

<label>Full Address *</label>
<input id="address">

<label>District *</label>
<input id="districtSearch" class="search" placeholder="Search district">
<select id="district"></select>

<label>Thana / Upazila *</label>
<input id="thanaSearch" class="search" placeholder="Search thana">
<select id="thana"></select>

<img id="productImg" class="product-img" alt="Product Image">

<div class="info"><b>Product:</b> <span id="productName"></span></div>
<div class="info"><b>Price:</b> ৳ <span id="price"></span></div>

<label>Quantity</label>
<select id="qty">
  <option value="1">1</option>
  <option value="2">2</option>
  <option value="3">3</option>
</select>

<div class="total">Total: ৳ <span id="total"></span></div>

<div class="note">
Delivery Info (Not Added):<br>
Inside Dhaka – ৳60<br>
Outside Dhaka – ৳120
</div>

<button onclick="placeOrder()">Confirm Order</button>

</div>
</div>

<script>
/* ---------------- PRODUCT ---------------- */
const params = new URLSearchParams(window.location.search);
const product = params.get("product") || "Arc Lighter";
const price = parseInt(params.get("price")) || 850;

document.getElementById("productName").innerText = product;
document.getElementById("price").innerText = price;

if(product.toLowerCase().includes("lighter")){
  document.getElementById("productImg").src = "arc-lighter.jpg";
}else{
  document.getElementById("productImg").src = "nose-hair-trimmer.jpg";
}

/* ---------------- TOTAL ---------------- */
function calc(){
  const qty = parseInt(document.getElementById("qty").value);
  document.getElementById("total").innerText = price * qty;
}
document.getElementById("qty").addEventListener("change", calc);
calc();

/* ---------------- ORDER ID ---------------- */
function orderId(){
  return "TM" + Math.floor(10000 + Math.random()*90000);
}

/* ---------------- WHATSAPP ---------------- */
function placeOrder(){
  const name = document.getElementById("name").value.trim();
  const phone = document.getElementById("phone").value.trim();
  const address = document.getElementById("address").value.trim();
  const district = document.getElementById("district").value;
  const thana = document.getElementById("thana").value;
  const qty = document.getElementById("qty").value;

  if(!name || !phone || !address || !district || !thana){
    alert("Please fill all required fields");
    return;
  }

  const now = new Date();
  const msg =
`Titan Mart BD Order

Order ID: ${orderId()}
Date: ${now.toLocaleDateString()}
Time: ${now.toLocaleTimeString()}

Name: ${name}
Phone: ${phone}
Address: ${address}
District: ${district}
Thana: ${thana}

Product: ${product}
Price: ৳${price}
Quantity: ${qty}
Total: ৳${price * qty}

Delivery Info:
Inside Dhaka – ৳60
Outside Dhaka – ৳120`;

  window.open(
    "https://wa.me/8801980236917?text=" + encodeURIComponent(msg),
    "_blank"
  );
}

/* ---------------- DISTRICT & THANA ---------------- */
const districtSelect = document.getElementById("district");
const thanaSelect = document.getElementById("thana");
const districtSearch = document.getElementById("districtSearch");
const thanaSearch = document.getElementById("thanaSearch");

let upazilaData = {};

fetch("bangladesh_upazilas.json")
.then(res => res.json())
.then(data => {
  upazilaData = data;
  loadDistricts();
});

function loadDistricts(filter=""){
  districtSelect.innerHTML = "";
  Object.keys(upazilaData)
    .filter(d => d.toLowerCase().includes(filter))
    .forEach(d => {
      const opt = document.createElement("option");
      opt.value = d;
      opt.textContent = d;
      districtSelect.appendChild(opt);
    });
  loadThanas();
}

function loadThanas(filter=""){
  thanaSelect.innerHTML = "";
  (upazilaData[districtSelect.value] || [])
    .filter(t => t.toLowerCase().includes(filter))
    .forEach(t => {
      const opt = document.createElement("option");
      opt.value = t;
      opt.textContent = t;
      thanaSelect.appendChild(opt);
    });
}

districtSelect.addEventListener("change", () => loadThanas());
districtSearch.addEventListener("input", e => loadDistricts(e.target.value.toLowerCase()));
thanaSearch.addEventListener("input", e => loadThanas(e.target.value.toLowerCase()));
</script>

</body>
</html>
