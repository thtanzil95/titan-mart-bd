<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<title>Checkout | Titan Mart BD</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{margin:0;font-family:Arial,sans-serif;background:#f5f5f5;}
.container{max-width:720px;margin:40px auto;padding:0;}
.lang-btn{ text-align:right; cursor:pointer; color:#ff4c00; font-weight:bold; margin-bottom:15px; }
.card{background:#fff;border-radius:12px;box-shadow:0 10px 30px rgba(0,0,0,0.15);padding:25px;animation:fadeIn 0.4s;}
h2{text-align:center;color:#ff4c00;margin-bottom:20px;font-weight:600;}
input,select{width:100%;padding:12px;margin-top:10px;border:1px solid #ccc;border-radius:8px;transition:0.3s;}
input:focus,select:focus{border-color:#ff4c00;outline:none;box-shadow:0 0 6px rgba(255,76,0,0.3);}
button{width:100%;padding:15px;margin-top:20px;background:#ff4c00;color:#fff;border:none;font-size:16px;border-radius:8px;cursor:pointer;transition:0.3s;}
button:hover{background:#e04300;}
.info{margin-top:12px;}
.product-img{width:100%;max-height:260px;object-fit:contain;margin-top:15px;border-radius:10px;}
.delivery-info{margin-top:8px;color:#ff4c00;font-weight:bold;}
@keyframes fadeIn{from{opacity:0;transform:translateY(-10px);}to{opacity:1;transform:translateY(0);}}
</style>
</head>
<body>

<div class="container">
  <div class="lang-btn" onclick="toggleLang()">EN</div>
  <div class="card">
    <h2 id="title">‡¶ö‡ßá‡¶ï‡¶Ü‡¶â‡¶ü</h2>

    <!-- Customer Info -->
    <input id="name" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ">
    <input id="phone" placeholder="‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞">
    <input id="address" placeholder="‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ">

    <!-- District & Upazila -->
    <div class="info">
      <b id="dLabel">‡¶ú‡ßá‡¶≤‡¶æ:</b>
      <input type="text" id="districtSearch" placeholder="‡¶ú‡ßá‡¶≤‡¶æ ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßÅ‡¶®...">
      <select id="district"></select>
    </div>
    <div class="info">
      <b id="thLabel">‡¶•‡¶æ‡¶®‡¶æ/‡¶â‡¶™‡¶ú‡ßá‡¶≤‡¶æ:</b>
      <input type="text" id="thanaSearch" placeholder="‡¶•‡¶æ‡¶®‡¶æ/‡¶â‡¶™‡¶ú‡ßá‡¶≤‡¶æ ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßÅ‡¶®...">
      <select id="thana"></select>
    </div>

    <!-- Product Info -->
    <img id="productImg" class="product-img" src="" alt="Product Image">
    <div class="info"><b id="pLabel">‡¶™‡¶£‡ßç‡¶Ø:</b> <span id="product"></span></div>
    <div class="info"><b id="prLabel">‡¶Æ‡ßÇ‡¶≤‡ßç‡¶Ø:</b> ‡ß≥ <span id="price"></span></div>
    <select id="qty">
      <option value="1">1</option>
      <option value="2">2</option>
      <option value="3">3</option>
      <option value="4">4</option>
    </select>

    <!-- Delivery & Total -->
    <div class="info" style="font-weight:bold;"><b id="tLabel">‡¶Æ‡ßã‡¶ü:</b> ‡ß≥ <span id="total"></span></div>
    <div class="delivery-info">‡¶°‡ßá‡¶≤‡¶ø‡¶≠‡¶æ‡¶∞‡¶ø ‡¶ö‡¶æ‡¶∞‡ßç‡¶ú: Inside Dhaka 60 ‡ß≥ | Outside Dhaka 120 ‡ß≥</div>

    <button onclick="placeOrder()" id="btn">‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶ï‡¶®‡¶´‡¶æ‡¶∞‡ßç‡¶Æ ‡¶ï‡¶∞‡ßÅ‡¶®</button>
  </div>
</div>

<script>
// Product details from URL
const params = new URLSearchParams(window.location.search);
const product = params.get("product");
const price = parseInt(params.get("price"));

// Set product name and price
document.getElementById("product").innerText = product;
document.getElementById("price").innerText = price;

// Set product image
let productImg = "";
if(product==="Arc Lighter"){
    productImg = "arc-lighter.jpg";
}else if(product==="Nose Hair Trimmer"){
    productImg = "nose-hair-trimmer.jpg";
}else{
    productImg = "default.jpg";
}
document.getElementById("productImg").src = productImg;

// Unique Order ID
function orderID(){ return "TM"+Math.floor(100000+Math.random()*900000); }

// Place order
function placeOrder(){
  const name = document.getElementById("name").value.trim();
  const phone = document.getElementById("phone").value.trim();
  const address = document.getElementById("address").value.trim();
  const district = document.getElementById("district").value.trim();
  const thana = document.getElementById("thana").value;
  const qty = document.getElementById("qty").value;

  if(!name || !phone || !address){
    alert("‡¶¶‡¶Ø‡¶º‡¶æ ‡¶ï‡¶∞‡ßá ‡¶®‡¶æ‡¶Æ, ‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶è‡¶¨‡¶Ç ‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ ‡¶™‡ßÇ‡¶∞‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®!");
    return;
  }

  let delivery = 120;
  if(district === "‡¶¢‡¶æ‡¶ï‡¶æ"){ delivery = 60; }

  const total = price*qty;

  const id = orderID();
  const now = new Date();
  const date = now.toLocaleDateString('bn-BD', {day:'2-digit', month:'2-digit', year:'numeric'});
  const time = now.toLocaleTimeString('en-US', {hour12:false});

  // WhatsApp message
  const msg = `Order ID: ${id}
Date: ${date}
Time: ${time}
Name: ${name}
Phone: ${phone}
Address: ${address}
District: ${district}
Thana/Upazila: ${thana}
Product: ${product}
Quantity: ${qty}
Delivery Charge: ‡ß≥${delivery}
Total: ‡ß≥${total + delivery}`;

  window.open("https://wa.me/8801980236917?text="+encodeURIComponent(msg), "_blank");

  // Confirmation popup
  const popupHtml = `
    <html>
      <head>
        <title>Order Success | Titan Mart BD</title>
        <style>
          body{font-family:Arial,sans-serif;text-align:center;padding:30px;background:#fef9f4;}
          h2{color:#ff4c00;}
          .summary{background:#fff;padding:20px;border-radius:12px;box-shadow:0 5px 20px rgba(0,0,0,0.2);display:inline-block;text-align:left;}
          .summary b{color:#ff4c00;}
          .greeting{margin-top:15px;font-size:18px;color:#333;font-weight:500;}
        </style>
      </head>
      <body>
        <h2>üéâ ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶®! üéâ</h2>
        <div class="summary">
          <p><b>Order ID:</b> ${id}</p>
          <p><b>Date:</b> ${date}</p>
          <p><b>Time:</b> ${time}</p>
          <p><b>Name:</b> ${name}</p>
          <p><b>Phone:</b> ${phone}</p>
          <p><b>Address:</b> ${address}</p>
          <p><b>District:</b> ${district}</p>
          <p><b>Thana/Upazila:</b> ${thana}</p>
          <p><b>Product:</b> ${product}</p>
          <p><b>Quantity:</b> ${qty}</p>
          <p><b>Total:</b> ‡ß≥${total}</p>
          <p><b>Delivery Charge:</b> Inside Dhaka 60 ‡ß≥ | Outside Dhaka 120 ‡ß≥</p>
        </div>
        <div class="greeting">
          ‡¶ß‡¶®‡ßç‡¶Ø‡¶¨‡¶æ‡¶¶! ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶ó‡ßç‡¶∞‡¶π‡¶£ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§ ‡¶Ü‡¶Æ‡¶æ‡¶¶‡ßá‡¶∞ ‡¶™‡ßç‡¶∞‡¶ø‡¶Æ‡¶ø‡¶Ø‡¶º‡¶æ‡¶Æ ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶ø‡¶∏‡ßá‡¶∞ ‡¶Æ‡¶æ‡¶ß‡ßç‡¶Ø‡¶Æ‡ßá ‡¶∂‡ßÄ‡¶ò‡ßç‡¶∞‡¶á ‡¶°‡ßá‡¶≤‡¶ø‡¶≠‡¶æ‡¶∞‡¶ø ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶¨‡ßá‡•§
        </div>
      </body>
    </html>
  `;
  const popup = window.open("", "_blank", "width=500,height=650");
  popup.document.write(popupHtml);
  popup.document.close();
}

// Bangla / English toggle
let bn=true;
function toggleLang(){
  bn=!bn;
  document.getElementById("title").innerText=bn?"‡¶ö‡ßá‡¶ï‡¶Ü‡¶â‡¶ü":"Checkout";
  document.getElementById("name").placeholder=bn?"‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ":"Your Name";
  document.getElementById("phone").placeholder=bn?"‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞":"Phone Number";
  document.getElementById("address").placeholder=bn?"‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶†‡¶ø‡¶ï‡¶æ‡¶®‡¶æ":"Full Address";
  document.getElementById("pLabel").innerText=bn?"‡¶™‡¶£‡ßç‡¶Ø:":"Product:";
  document.getElementById("prLabel").innerText=bn?"‡¶Æ‡ßÇ‡¶≤‡ßç‡¶Ø:":"Price:";
  document.getElementById("tLabel").innerText=bn?"‡¶Æ‡ßã‡¶ü:":"Total:";
  document.querySelector(".delivery-info").innerText=bn?"‡¶°‡ßá‡¶≤‡¶ø‡¶≠‡¶æ‡¶∞‡¶ø ‡¶ö‡¶æ‡¶∞‡ßç‡¶ú: Inside Dhaka 60 ‡ß≥ | Outside Dhaka 120 ‡ß≥":"Delivery Charge: Inside Dhaka 60 ‡ß≥ | Outside Dhaka 120 ‡ß≥";
  document.getElementById("dLabel").innerText=bn?"‡¶ú‡ßá‡¶≤‡¶æ:":"District:";
  document.getElementById("thLabel").innerText=bn?"‡¶•‡¶æ‡¶®‡¶æ/‡¶â‡¶™‡¶ú‡ßá‡¶≤‡¶æ:":"Thana/Upazila:";
  document.getElementById("btn").innerText=bn?"‡¶Ö‡¶∞‡ßç‡¶°‡¶æ‡¶∞ ‡¶ï‡¶®‡¶´‡¶æ‡¶∞‡ßç‡¶Æ ‡¶ï‡¶∞‡ßÅ‡¶®":"Confirm Order";
  document.querySelector(".lang-btn").innerText=bn?"EN":"BN";
}

// Load JSON upazila
let upazilaData = {};
fetch("bangladesh_upazilas.json")
.then(resp=>resp.json())
.then(data=>{upazilaData=data; populateDistricts();});

// Populate district
function populateDistricts(){
  const sel=document.getElementById("district");
  Object.keys(upazilaData).forEach(d=>{
    let o=document.createElement("option"); o.value=d; o.text=d; sel.add(o);
  });
  calc();
  populateThana();
}

// Populate thana
function populateThana(){
  const sel=document.getElementById("thana");
  sel.innerHTML="";
  const dist=document.getElementById("district").value;
  (upazilaData[dist]||[]).forEach(t=>{
    let o=document.createElement("option"); o.value=t; o.text=t; sel.add(o);
  });
  calc();
}

// Calculate total (without delivery)
function calc(){
  const qty=parseInt(document.getElementById("qty").value);
  document.getElementById("total").innerText = price*qty;
}

document.getElementById("qty").onchange=calc;
document.getElementById("district").onchange=()=>{populateThana(); calc();};

// Search filter
document.getElementById("districtSearch").oninput=function(){
  const f=this.value.toLowerCase();
  const sel=document.getElementById("district"); sel.innerHTML="";
  Object.keys(upazilaData).filter(d=>d.toLowerCase().includes(f)).forEach(d=>{
    let o=document.createElement("option"); o.value=d; o.text=d; sel.add(o);
  });
  populateThana();
};
document.getElementById("thanaSearch").oninput=function(){
  const f=this.value.toLowerCase();
  const sel=document.getElementById("thana"); sel.innerHTML="";
  const dist=document.getElementById("district").value;
  (upazilaData[dist]||[]).filter(t=>t.toLowerCase().includes(f)).forEach(t=>{
    let o=document.createElement("option"); o.value=t; o.text=t; sel.add(o);
  });
};
</script>
</body>
</html>
