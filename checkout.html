<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Checkout | Titan Mart</title>
<style>
body{font-family:Arial, sans-serif; padding:20px; background:#f7f7f7;}
h2{text-align:center; color:#ff4c00;}
form{max-width:500px;margin:auto;background:white;padding:20px;border-radius:10px;box-shadow:0 2px 10px rgba(0,0,0,0.1);}
input, select{padding:10px; margin:10px 0; width:100%; border-radius:5px; border:1px solid #ccc;}
button{background:#ff4c00;color:white;padding:12px; width:100%; border:none; border-radius:5px; cursor:pointer; font-size:16px;}
button:hover{background:#e24300;}
.total{font-weight:bold; font-size:18px; margin:10px 0;}
</style>
</head>
<body>

<h2>Checkout Page</h2>

<form id="checkoutForm">
  Name: <input id="name" type="text" required><br>
  Phone: <input id="phone" type="text" required><br>
  Alt Phone: <input id="altphone" type="text"><br>

  District:
  <select id="district" onchange="updateThanaAndDelivery()" required>
    <option value="">Select District</option>
  </select><br>

  Thana / Upazila:
  <select id="thana" required>
    <option value="">Select Thana</option>
  </select><br>

  Address: <input id="address" type="text" required><br>

  Product:
  <select id="product" onchange="updateTotal()">
    <option value="850">Arc Lighter</option>
    <option value="840">Nose Hair Trimmer</option>
  </select><br>

  Quantity: <input id="qty" type="number" value="1" min="1" onchange="updateTotal()"><br>

  Delivery Charge: <span id="deliveryCharge">0</span> Taka<br>
  <div class="total">Total: <span id="total">0</span> Taka</div><br>

  <button type="button" onclick="sendOrder()">Place Order</button>
</form>

<script>
// Bangladesh Districts + Thanas
const bangladesh = {
  "Dhaka": ["Dhanmondi", "Gulshan", "Banani", "Mirpur", "Mohakhali", "Motijheel"],
  "Chattogram": ["Pahartali", "Kotwali", "Chandgaon", "Halishahar", "Patiya"],
  "Khulna": ["Daulatpur", "Khalishpur", "Sonadanga"],
  "Rajshahi": ["Boalia", "Chhota Natore", "Motihar"],
  "Barishal": ["Babuganj", "Bakerganj", "Barishal Sadar"],
  "Sylhet": ["Sylhet Sadar", "Beanibazar", "Fenchuganj"],
  "Rangpur": ["Rangpur Sadar", "Gangachara", "Kaunia"],
  "Mymensingh": ["Mymensingh Sadar", "Bhaluka", "Trishal"],
  "Comilla": ["Comilla Sadar", "Chandina", "Muradnagar"],
  "Jessore": ["Jessore Sadar", "Abhaynagar", "Bagherpara"],
  "Tangail": ["Tangail Sadar", "Madhupur", "Nagarpur"],
  "Pabna": ["Pabna Sadar", "Atghoria", "Bera"],
  "Narsingdi": ["Narsingdi Sadar", "Belabo", "Raipura"],
  "Noakhali": ["Noakhali Sadar", "Begumganj", "Chatkhil"]
};

// Populate district dropdown
const districtSelect = document.getElementById("district");
for(let dist in bangladesh){
  let opt = document.createElement("option");
  opt.value = dist;
  opt.textContent = dist;
  districtSelect.appendChild(opt);
}

// Populate Thana based on district
function updateThanaAndDelivery(){
  const thanaSelect = document.getElementById("thana");
  thanaSelect.innerHTML = '<option value="">Select Thana</option>';
  const dist = districtSelect.value;

  if(dist){
    bangladesh[dist].forEach(t=>{
      let opt = document.createElement("option");
      opt.value = t;
      opt.textContent = t;
      thanaSelect.appendChild(opt);
    });
  }

  // Set delivery charge
  let deliveryCharge = (dist==="Dhaka") ? 60 : 120;
  document.getElementById("deliveryCharge").innerText = deliveryCharge;
  updateTotal();
}

// Update total price
function updateTotal(){
  let productPrice = parseInt(document.getElementById("product").value);
  let qty = parseInt(document.getElementById("qty").value);
  let delivery = parseInt(document.getElementById("deliveryCharge").innerText);
  let total = (productPrice * qty) + delivery;
  document.getElementById("total").innerText = total;
}

// Send order function
function sendOrder(){
  let name = document.getElementById("name").value;
  let phone = document.getElementById("phone").value;
  let altphone = document.getElementById("altphone").value;
  let district = document.getElementById("district").value;
  let thana = document.getElementById("thana").value;
  let address = document.getElementById("address").value;
  let productText = document.getElementById("product").options[document.getElementById("product").selectedIndex].text;
  let qty = document.getElementById("qty").value;
  let total = document.getElementById("total").innerText;
  let deliveryCharge = document.getElementById("deliveryCharge").innerText;

  if(!name || !phone || !district || !thana || !address){
    alert("Please fill all required fields!");
    return;
  }

  let msg = encodeURIComponent(
    `üõí New Order\n\nüë§ Name: ${name}\nüìû Phone: ${phone}\nüìû Alt: ${altphone}\nüìç District: ${district}\nüèò Thana: ${thana}\nüè† Address: ${address}\nüì¶ Product: ${productText}\nüî¢ Qty: ${qty}\nüöö Delivery Charge: ${deliveryCharge} Taka\nüí∞ Total: ${total} Taka`
  );

  let win = window.open("https://wa.me/8801980236917?text="+msg,"_blank");
  if(win) win.focus();

  // Send order to Google Sheet
  fetch("WEB_APP_URL_HERE", {
    method:"POST",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify({
      name, phone, altphone, district, thana, address,
      product: productText, qty, delivery: deliveryCharge, total
    })
  })
  .then(res=>res.json())
  .then(data=>console.log(data))
  .catch(err=>console.error(err));

  let proceed = confirm("WhatsApp ‡¶ñ‡ßÅ‡¶≤‡ßá‡¶õ‡ßá‡•§ Message ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã‡¶∞ ‡¶™‡¶∞ Success page ‡¶è ‡¶Ø‡ßá‡¶§‡ßá OK ‡¶ö‡¶æ‡¶™‡ßÅ‡¶®‡•§");
  if(proceed) window.location.href="success.html";
}

// Initialize
updateTotal();
</script>

</body>
</html>
